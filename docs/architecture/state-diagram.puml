@startuml VM and Disk State Diagrams

state "VM State Machine" as VMState {
    [*] --> stopped : POST /vms
    
    running --> stopped : POST /vms/{id}/actions/stop
    running --> running : POST /vms/{id}/actions/restart
    running --> [*] : DELETE /vms/{id}
    
    stopped --> running : POST /vms/{id}/actions/start
    stopped --> [*] : DELETE /vms/{id}
    
    running --> error : Start/Stop failure
    stopped --> error : Start failure
    error --> [*] : DELETE /vms/{id}
}

state "Disk State Machine" as DiskState {
    [*] --> available : POST /disks
    
    available --> attached : POST /disks/{id}/attach
    available --> [*] : DELETE /disks/{id}
    
    attached --> available : POST /disks/{id}/detach
    attached --> [*] : DELETE /disks/{id} (if VM stopped)
    
    available --> error : Creation failure
    attached --> error : Attach/Detach failure
    error --> [*] : DELETE /disks/{id}
}

note right of VMState
  VM States:
  - stopped: VM created or stopped, resources cleaned
  - running: QEMU process active
  - error: Operation failed
end note

note right of DiskState
  Disk States:
  - available: Disk created, not attached
  - attached: Disk attached to VM
  - error: Operation failed
end note

@enduml

